# URL Alias Service (Clean Architecture)

Сервис для сокращения URL, разработанный с применением принципов чистой архитектуры. Управление зависимостями и задачами осуществляется с помощью **`Makefile`**, который использует **`uv`** под капотом.

## Возможности

*   Создание коротких ссылок с заданным сроком жизни.
*   Перенаправление с коротких ссылок на оригинальные.
*   Деактивация ссылок (мягкое удаление).
*   Сбор и просмотр статистики по кликам (за последний час и день).
*   Разделение API на публичные и приватные эндпоинты (Basic Auth).
*   Автоматическая документация API через Swagger UI.

## Технологический стек и Принципы

*   **Архитектура**: Clean Architecture, SOLID, DRY, KISS.
*   **Фреймворк**: FastAPI.
*   **СУБД**: PostgreSQL (запускается через Docker).
*   **Управление**: `Makefile` + `uv` (`pyproject.toml`, `uv.lock`).
*   **Тестирование**: Unit и Интеграционные тесты на `pytest`.

---

## Инструкция по локальному развертыванию

### Шаг 1: Предустановки

1.  Установите **Python 3.10+**.
2.  Установите **Docker** и **Docker Compose**.
3.  Установите **`uv`**: `curl -LsSf https://astral.sh/uv/install.sh | sh` (для macOS/Linux).
4.  Убедитесь, что у вас установлен `make`.

### Шаг 2: Настройка проекта

1.  **Клонируйте репозиторий** и перейдите в него.
2.  **Настройте переменные окружения:** `cp .env.example .env`
3.  **Запустите базу данных:** `make run-db`
4.  **Создайте тестовую базу данных** (требуется один раз):
    ```bash
    psql -h localhost -p 5432 -U user -d shortener -c "CREATE DATABASE shortener_test;"
    ```
    (Пароль по умолчанию `password`, если запросит).

### Шаг 3: Установка зависимостей

1.  **Создайте и активируйте виртуальное окружение:**
    ```bash
    uv venv
    source .venv/bin/activate  # Для Unix/macOS
    # .venv\Scripts\activate   # Для Windows
    ```
2.  **Установите зависимости:**
    Эта команда использует `uv sync` для установки пакетов из `uv.lock`.
    ```bash
    make install
    ```
    *Примечание: Если вы изменили `pyproject.toml`, сначала выполните `make lock`, чтобы обновить `uv.lock`.*

### Шаг 4: Работа с приложением

*   **Запуск сервера для разработки:** `make run`
*   **Создание пользователя API:** `make create-user`
*   **Запуск тестов:** `make test`

Сервер будет доступен на `http://localhost:8000`.
API-документация: `http://localhost:8000/docs`.